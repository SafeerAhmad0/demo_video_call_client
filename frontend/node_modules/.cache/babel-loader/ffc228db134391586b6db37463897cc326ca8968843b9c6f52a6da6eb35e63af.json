{"ast":null,"code":"import React,{useEffect,useState}from\"react\";import{useSearchParams,useNavigate}from\"react-router-dom\";import JitsiMeeting from\"../components/JitsiMeeting\";import{getJitsiToken,videoCallAPI}from\"../services/api\";import{useAuth}from\"../contexts/AuthContext\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function Meeting(){const[token,setToken]=useState(null);const[loading,setLoading]=useState(true);const[error,setError]=useState(null);const[searchParams]=useSearchParams();const navigate=useNavigate();const{user}=useAuth();const sessionId=searchParams.get('sessionId');const roomName=searchParams.get('roomName')||\"default-room\";useEffect(()=>{async function initializeMeeting(){try{if(!sessionId){throw new Error('Session ID is required');}if(!user){throw new Error('User not authenticated');}// Get Jitsi token\nconst tokenResponse=await getJitsiToken(roomName,user.email,user.email,true// isModerator\n);setToken(tokenResponse.data.token);setLoading(false);}catch(err){console.error('Error initializing meeting:',err);setError(err instanceof Error?err.message:'Failed to initialize meeting');setLoading(false);}}initializeMeeting();},[sessionId,roomName,user]);const handleMeetingEnd=async()=>{try{if(sessionId){// Update video call status to completed\nawait videoCallAPI.updateStatus(sessionId,'completed');}// Navigate back to dashboard\nnavigate('/dashboard');}catch(err){console.error('Error ending meeting:',err);// Still navigate back even if status update fails\nnavigate('/dashboard');}};if(loading){return/*#__PURE__*/_jsx(\"div\",{className:\"min-h-screen flex items-center justify-center bg-gray-100\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600 text-lg\",children:\"Loading video conference...\"})]})});}if(error){return/*#__PURE__*/_jsx(\"div\",{className:\"min-h-screen flex items-center justify-center bg-gray-100\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"text-center p-8\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-red-500 text-6xl mb-4\",children:\"\\u26A0\\uFE0F\"}),/*#__PURE__*/_jsx(\"h3\",{className:\"text-xl font-semibold text-gray-800 mb-2\",children:\"Failed to Load Meeting\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600 mb-4\",children:error}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-x-4\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>window.location.reload(),className:\"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors\",children:\"Retry\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>navigate('/dashboard'),className:\"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600 transition-colors\",children:\"Back to Dashboard\"})]})]})});}if(!token){return/*#__PURE__*/_jsx(\"div\",{className:\"min-h-screen flex items-center justify-center bg-gray-100\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600\",children:\"Preparing video conference...\"})]})});}return/*#__PURE__*/_jsx(\"div\",{style:{height:\"100vh\",width:\"100%\"},children:/*#__PURE__*/_jsx(JitsiMeeting,{domain:\"meet.jit.si\",roomName:roomName,jwt:token,configOverwrite:{startWithAudioMuted:true,startWithVideoMuted:false,enableWelcomePage:false,prejoinPageEnabled:false},interfaceConfigOverwrite:{TOOLBAR_BUTTONS:['microphone','camera','closedcaptions','desktop','fullscreen','fodeviceselection','hangup','profile','chat','recording','settings','raisehand','videoquality','filmstrip','stats','shortcuts','tileview','help']},onReadyToClose:handleMeetingEnd,getIFrameRef:iframeRef=>{if(iframeRef){iframeRef.style.height=\"100%\";iframeRef.style.width=\"100%\";}}})});}","map":{"version":3,"names":["React","useEffect","useState","useSearchParams","useNavigate","JitsiMeeting","getJitsiToken","videoCallAPI","useAuth","jsx","_jsx","jsxs","_jsxs","Meeting","token","setToken","loading","setLoading","error","setError","searchParams","navigate","user","sessionId","get","roomName","initializeMeeting","Error","tokenResponse","email","data","err","console","message","handleMeetingEnd","updateStatus","className","children","onClick","window","location","reload","style","height","width","domain","jwt","configOverwrite","startWithAudioMuted","startWithVideoMuted","enableWelcomePage","prejoinPageEnabled","interfaceConfigOverwrite","TOOLBAR_BUTTONS","onReadyToClose","getIFrameRef","iframeRef"],"sources":["C:/Users/samee/OneDrive/Desktop/Testing_Video_App/verifycall-app_v5_240825/frontend/src/pages/MeetingPage.tsx"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\r\nimport { useSearchParams, useNavigate } from \"react-router-dom\";\r\nimport JitsiMeeting from \"../components/JitsiMeeting\";\r\nimport { getJitsiToken, videoCallAPI } from \"../services/api\";\r\nimport { useAuth } from \"../contexts/AuthContext\";\r\n\r\nexport default function Meeting() {\r\n  const [token, setToken] = useState<string | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [searchParams] = useSearchParams();\r\n  const navigate = useNavigate();\r\n  const { user } = useAuth();\r\n\r\n  const sessionId = searchParams.get('sessionId');\r\n  const roomName = searchParams.get('roomName') || \"default-room\";\r\n\r\n  useEffect(() => {\r\n    async function initializeMeeting() {\r\n      try {\r\n        if (!sessionId) {\r\n          throw new Error('Session ID is required');\r\n        }\r\n\r\n        if (!user) {\r\n          throw new Error('User not authenticated');\r\n        }\r\n\r\n        // Get Jitsi token\r\n        const tokenResponse = await getJitsiToken(\r\n          roomName,\r\n          user.email,\r\n          user.email,\r\n          true // isModerator\r\n        );\r\n        \r\n        setToken(tokenResponse.data.token);\r\n        setLoading(false);\r\n      } catch (err) {\r\n        console.error('Error initializing meeting:', err);\r\n        setError(err instanceof Error ? err.message : 'Failed to initialize meeting');\r\n        setLoading(false);\r\n      }\r\n    }\r\n\r\n    initializeMeeting();\r\n  }, [sessionId, roomName, user]);\r\n\r\n  const handleMeetingEnd = async () => {\r\n    try {\r\n      if (sessionId) {\r\n        // Update video call status to completed\r\n        await videoCallAPI.updateStatus(sessionId, 'completed');\r\n      }\r\n      // Navigate back to dashboard\r\n      navigate('/dashboard');\r\n    } catch (err) {\r\n      console.error('Error ending meeting:', err);\r\n      // Still navigate back even if status update fails\r\n      navigate('/dashboard');\r\n    }\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"min-h-screen flex items-center justify-center bg-gray-100\">\r\n        <div className=\"text-center\">\r\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4\"></div>\r\n          <p className=\"text-gray-600 text-lg\">Loading video conference...</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <div className=\"min-h-screen flex items-center justify-center bg-gray-100\">\r\n        <div className=\"text-center p-8\">\r\n          <div className=\"text-red-500 text-6xl mb-4\">⚠️</div>\r\n          <h3 className=\"text-xl font-semibold text-gray-800 mb-2\">\r\n            Failed to Load Meeting\r\n          </h3>\r\n          <p className=\"text-gray-600 mb-4\">{error}</p>\r\n          <div className=\"space-x-4\">\r\n            <button\r\n              onClick={() => window.location.reload()}\r\n              className=\"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors\"\r\n            >\r\n              Retry\r\n            </button>\r\n            <button\r\n              onClick={() => navigate('/dashboard')}\r\n              className=\"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600 transition-colors\"\r\n            >\r\n              Back to Dashboard\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!token) {\r\n    return (\r\n      <div className=\"min-h-screen flex items-center justify-center bg-gray-100\">\r\n        <div className=\"text-center\">\r\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4\"></div>\r\n          <p className=\"text-gray-600\">Preparing video conference...</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div style={{ height: \"100vh\", width: \"100%\" }}>\r\n      <JitsiMeeting\r\n        domain=\"meet.jit.si\"\r\n        roomName={roomName}\r\n        jwt={token}\r\n        configOverwrite={{ \r\n          startWithAudioMuted: true,\r\n          startWithVideoMuted: false,\r\n          enableWelcomePage: false,\r\n          prejoinPageEnabled: false,\r\n        }}\r\n        interfaceConfigOverwrite={{\r\n          TOOLBAR_BUTTONS: [\r\n            'microphone',\r\n            'camera',\r\n            'closedcaptions',\r\n            'desktop',\r\n            'fullscreen',\r\n            'fodeviceselection',\r\n            'hangup',\r\n            'profile',\r\n            'chat',\r\n            'recording',\r\n            'settings',\r\n            'raisehand',\r\n            'videoquality',\r\n            'filmstrip',\r\n            'stats',\r\n            'shortcuts',\r\n            'tileview',\r\n            'help',\r\n          ],\r\n        }}\r\n        onReadyToClose={handleMeetingEnd}\r\n        getIFrameRef={(iframeRef) => {\r\n          if (iframeRef) {\r\n            iframeRef.style.height = \"100%\";\r\n            iframeRef.style.width = \"100%\";\r\n          }\r\n        }}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}